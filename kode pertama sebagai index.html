<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Digital RT 006 - v7.2.5 (Final Stable)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; scroll-behavior: smooth; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .active-link { background: #312e81 !important; color: white !important; box-shadow: 0 10px 15px -3px rgba(49, 46, 129, 0.3); }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-900">

    <div class="flex min-h-screen">
        <aside class="w-64 bg-indigo-950 text-white p-6 hidden lg:block fixed h-full z-50 shadow-2xl">
            <div class="text-center mb-10 pb-6 border-b border-indigo-800">
                <div class="w-14 h-14 bg-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-indigo-500/20">
                    <i class="fas fa-id-card text-xl text-indigo-100"></i>
                </div>
                <h1 class="text-lg font-black tracking-tight leading-none uppercase">RT 006 / RW 003</h1>
                <p class="text-[9px] text-indigo-400 font-bold uppercase tracking-[0.2em] mt-3">Smart RT System v7.2.5</p>
            </div>
            
            <nav class="space-y-2">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="w-full flex items-center py-4 px-6 rounded-2xl active-link transition-all font-bold text-sm text-left">
                    <i class="fas fa-chart-line mr-4 w-5 opacity-80"></i> Dashboard
                </button>
                <button onclick="switchTab('admin')" id="nav-admin" class="w-full flex items-center py-4 px-6 rounded-2xl text-indigo-200 hover:bg-indigo-900/50 transition-all font-bold text-sm text-left">
                    <i class="fas fa-users mr-4 w-5 opacity-80"></i> Data Warga
                </button>
                <button onclick="switchTab('surat')" id="nav-surat" class="w-full flex items-center py-4 px-6 rounded-2xl text-indigo-200 hover:bg-indigo-900/50 transition-all font-bold text-sm text-left">
                    <i class="fas fa-file-contract mr-4 w-5 opacity-80"></i> Buat Surat
                </button>
            </nav>

            <div class="absolute bottom-8 left-6 right-6 space-y-3">
                <button onclick="printRekap()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-2xl text-[10px] font-black transition-all shadow-xl shadow-indigo-900/20 uppercase">
                    <i class="fas fa-file-pdf mr-2"></i> Cetak Laporan PDF
                </button>
            </div>
        </aside>

        <main class="flex-1 lg:ml-64 p-6 lg:p-12 bg-[#f8fafc]">
            
            <section id="tab-dashboard" class="tab-content active">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 gap-4">
                    <div>
                        <h2 class="text-4xl font-black text-slate-800 tracking-tight">Statistik Mutasi</h2>
                        <p class="text-slate-500 font-medium mt-1">Data kependudukan real-time RT 006.</p>
                    </div>
                    <div id="display-period" class="bg-indigo-50 text-indigo-700 px-6 py-3 rounded-2xl font-black text-xs tracking-widest border border-indigo-100 shadow-sm uppercase">-- --</div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                    <div class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">Total Laki-Laki</p>
                        <h3 id="count-laki" class="text-5xl font-black text-slate-800">0</h3>
                    </div>
                    <div class="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">Total Perempuan</p>
                        <h3 id="count-perempuan" class="text-5xl font-black text-slate-800">0</h3>
                    </div>
                    <div class="bg-indigo-900 p-8 rounded-[2.5rem] shadow-xl">
                        <p class="text-[10px] font-black text-indigo-300 uppercase tracking-[0.2em] mb-2">Total KK Aktif</p>
                        <h3 id="count-kk" class="text-5xl font-black text-white">0</h3>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[3rem] border border-slate-100 shadow-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table id="main-report-table" class="w-full text-center text-[11px] border-collapse min-w-[1000px]">
                            <thead>
                                <tr class="bg-slate-900 text-white font-black uppercase">
                                    <th class="p-5 border-r border-slate-800">KK AWAL</th>
                                    <th class="p-5 border-r border-slate-800" colspan="2">AWAL BULAN</th>
                                    <th class="p-5 border-r border-slate-800 text-emerald-400" colspan="2">LAHIR (+)</th>
                                    <th class="p-5 border-r border-slate-800 text-rose-400" colspan="2">MATI (-)</th>
                                    <th class="p-5 border-r border-slate-800 text-orange-400" colspan="2">PINDAH (-)</th>
                                    <th class="p-5 border-r border-slate-800 text-sky-400" colspan="2">DATANG (+)</th>
                                    <th class="p-5 border-r border-slate-800 bg-indigo-800" colspan="2">AKHIR BULAN</th>
                                    <th class="p-5 bg-indigo-950">KK AKHIR</th>
                                </tr>
                                <tr class="bg-slate-50 text-slate-500 border-b border-slate-200">
                                    <th class="border-r"></th><th class="p-3 border-r">L</th><th class="p-3 border-r">P</th><th class="p-3 border-r">L</th><th class="p-3 border-r">P</th><th class="p-3 border-r">L</th><th class="p-3 border-r">P</th><th class="p-3 border-r">L</th><th class="p-3 border-r">P</th><th class="p-3 border-r">L</th><th class="p-3 border-r">P</th><th class="p-3 border-r bg-indigo-50/50">L</th><th class="p-3 border-r bg-indigo-50/50">P</th><th></th>
                                </tr>
                            </thead>
                            <tbody class="text-lg font-bold text-slate-700">
                                <tr class="hover:bg-slate-50/50">
                                    <td id="rekap-kk-awal" class="p-10 border-r font-black">0</td>
                                    <td id="awal-l" class="p-10 border-r">0</td><td id="awal-p" class="p-10 border-r">0</td>
                                    <td id="lahir-l" class="p-10 border-r text-emerald-600">0</td><td id="lahir-p" class="p-10 border-r text-emerald-600">0</td>
                                    <td id="mati-l" class="p-10 border-r text-rose-600">0</td><td id="mati-p" class="p-10 border-r text-rose-600">0</td>
                                    <td id="pindah-l" class="p-10 border-r text-orange-600">0</td><td id="pindah-p" class="p-10 border-r text-orange-600">0</td>
                                    <td id="datang-l" class="p-10 border-r text-sky-600">0</td><td id="datang-p" class="p-10 border-r text-sky-600">0</td>
                                    <td id="akhir-l" class="p-10 border-r bg-indigo-50/50 text-indigo-700 font-black">0</td><td id="akhir-p" class="p-10 border-r bg-indigo-50/50 text-indigo-700 font-black">0</td>
                                    <td id="rekap-kk-akhir" class="p-10 bg-indigo-900 text-white font-black">0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="tab-admin" class="tab-content">
                <div class="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm mb-10">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
                        <h3 class="font-black text-xs uppercase tracking-[0.3em] text-indigo-600">Manajemen Database</h3>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="downloadTemplate()" class="bg-slate-100 text-slate-600 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase hover:bg-slate-200 transition-all"><i class="fas fa-file-excel mr-2"></i>Template</button>
                            <button onclick="document.getElementById('fileInput').click()" class="bg-emerald-50 text-emerald-600 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase border border-emerald-100 hover:bg-emerald-100 transition-all"><i class="fas fa-file-import mr-2"></i>Import</button>
                            <button onclick="hapusSemuaData()" class="bg-rose-50 text-rose-600 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase border border-rose-100 hover:bg-rose-600 hover:text-white transition-all"><i class="fas fa-trash-alt mr-2"></i>Hapus Semua</button>
                            <input type="file" id="fileInput" class="hidden" accept=".xlsx, .xls" onchange="importExcel(event)">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-6">
                        <div class="md:col-span-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">NIK</label>
                            <input type="text" id="nik" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">No. KK</label>
                            <input type="text" id="no_kk" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">Nama Lengkap</label>
                            <input type="text" id="nama" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">Gender</label>
                            <select id="gender" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-200 text-sm font-bold outline-none">
                                <option value="L">Laki-Laki</option>
                                <option value="P">Perempuan</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">Mutasi</label>
                            <select id="status_mutasi" class="w-full bg-indigo-50 p-4 rounded-2xl border border-indigo-100 text-sm font-black text-indigo-700 outline-none">
                                <option value="Tetap">Tetap</option>
                                <option value="Lahir">Lahir (+)</option>
                                <option value="Datang">Datang (+)</option>
                                <option value="Mati">Mati (-)</option>
                                <option value="Pindah">Pindah (-)</option>
                            </select>
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">Tempat Lahir</label>
                            <input type="text" id="tmpt_lahir" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-200 text-sm font-bold outline-none">
                        </div>
                        <div class="md:col-span-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 mb-2 block">Tgl Lahir</label>
                            <input type="date" id="tgl_lahir" class="w-full bg-slate-50 p-4 rounded-2xl border border-slate-200 text-sm font-bold outline-none">
                        </div>
                        <div class="md:col-span-2 flex items-end">
                            <button id="btnSimpan" onclick="tambahData()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-xl hover:bg-indigo-700 transition-all uppercase text-xs">Simpan Data</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-[3rem] border border-slate-100 shadow-xl overflow-hidden">
                    <div class="p-8 bg-slate-50/50">
                        <div class="relative w-full max-w-md">
                            <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="text" id="searchInput" onkeyup="cariWarga()" placeholder="Cari NIK atau Nama..." class="w-full bg-white border border-slate-200 pl-14 pr-6 py-4 rounded-2xl text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-xs">
                            <thead class="bg-slate-50 font-black text-slate-400 border-b uppercase">
                                <tr>
                                    <th class="p-6 text-center w-20">No</th>
                                    <th class="p-6">Identitas</th>
                                    <th class="p-6">Status & TTL</th>
                                    <th class="p-6 text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-warga-body" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="tab-surat" class="tab-content">
                <div class="bg-white p-12 rounded-[3rem] border border-slate-100 shadow-sm min-h-[600px]">
                    <div class="text-center max-w-2xl mx-auto mb-16">
                        <h2 class="text-4xl font-black text-slate-800 tracking-tight">Generator Surat Pengantar</h2>
                        <p class="text-slate-500 font-medium mt-3">Ketik NIK untuk mencari data secara otomatis.</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                        <div class="lg:col-span-5 space-y-8 bg-slate-50 p-10 rounded-[2.5rem] border border-slate-100">
                            <div>
                                <label class="text-[10px] font-black text-indigo-500 uppercase tracking-widest block mb-4">Pilih Warga (NIK)</label>
                                <input list="list-warga-nik" id="pilih-warga-surat" placeholder="Ketik NIK atau Nama..." class="w-full p-5 bg-white border-2 border-slate-100 rounded-2xl text-sm font-bold outline-none focus:border-indigo-500 shadow-sm transition-all">
                                <datalist id="list-warga-nik"></datalist>
                                <p class="text-[9px] text-slate-400 mt-3 ml-2 font-bold italic">* Sistem akan memfilter database secara otomatis.</p>
                            </div>
                            
                            <div>
                                <label class="text-[10px] font-black text-indigo-500 uppercase tracking-widest block mb-4">Keperluan</label>
                                <textarea id="keperluan-surat" placeholder="Contoh: Mengurus pembuatan Kartu Keluarga baru." class="w-full p-5 bg-white border-2 border-slate-100 rounded-2xl text-sm font-bold outline-none h-40 focus:border-indigo-500 shadow-sm resize-none"></textarea>
                            </div>
                            
                            <button onclick="generateSuratPDF()" class="w-full bg-indigo-950 text-white font-black py-5 rounded-2xl shadow-2xl hover:bg-indigo-900 transition-all flex items-center justify-center gap-3 uppercase tracking-widest text-xs">
                                <i class="fas fa-file-pdf"></i> Cetak Surat Sekarang
                            </button>
                        </div>
                        
                        <div id="preview-area" class="lg:col-span-7 bg-white rounded-[2.5rem] border-4 border-dashed border-slate-100 flex flex-col items-center justify-center p-12 text-center min-h-[500px]">
                            <div class="w-20 h-20 bg-slate-50 text-slate-200 rounded-full flex items-center justify-center mb-6">
                                <i class="fas fa-search text-3xl"></i>
                            </div>
                            <h4 class="font-black text-slate-400 text-lg tracking-tight uppercase">Belum Ada Preview</h4>
                            <p class="text-slate-400 text-sm mt-2">Data surat yang sudah dibuat akan muncul di sini.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>
